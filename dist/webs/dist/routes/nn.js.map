{"version":3,"sources":["../../../../webs/dist/routes/nn.js"],"names":["Object","defineProperty","exports","value","NN","Link","Neuron","LinkType","NeuronType","undefined","_createClass","defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","key","Constructor","protoProps","staticProps","prototype","derivativeFn","_fs","require","_classCallCheck","instance","TypeError","NONE","INPUT","HIDDEN","OUTPUT","INPUT_TO_HIDDEN","HIDDEN_TO_HIDDEN","HIDDEN_TO_OUTPUT","x","type","arguments","bias","Math","random","toFixed","fn","exp","computeValue","inputValue","getValue","setValue","setError","error","setBias","getError","fromConfig","config","neuronFromKey","neuronToKey","weight","generateWeight","setDeltaWeight","delta","prevDeltaWeight","deltaWeight","getDeltaWeight","getPrevDeltaWeight","setWeight","getWeight","networkConfiguration","networkPreInit","createReferences","initCore","_iteratorNormalCompletion","_didIteratorError","_iteratorError","_iterator","layers","Symbol","iterator","_step","next","done","layer","createLayer","err","return","inputSize","find","l","size","hiddenSize","outputSize","network","push","references","h","o","computeNeuronsValue","neuronType","linkType","print","_this","filter","forEach","r","reduce","prev","curr","computeGlobalError","derivativeFunc","_this2","n","computeHiddenErrors","_this3","ref","hiddenNeuron","newWeight","adjustInputs","_this4","trainNetwork","trainInputs","trainAnswers","_this5","prevError","learnCycles","cycles","_loop","randomSet","console","log","run","data","outputFn","_this6","output","networkStringConfiguration","networkSaveConfig","configuration","JSON","stringify","serializeToFile","appendFile","deserializeFromFile","path","_this7","readFile","content","deserializeObj","parse","map","c"],"mappings":"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","file":"nn.js","sourcesContent":["\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n    value: true\n});\nexports.NN = exports.Link = exports.Neuron = exports.LinkType = exports.NeuronType = undefined;\n\nvar _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if (\"value\" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();\n\nexports.derivativeFn = derivativeFn;\n\nvar _fs = require(\"fs\");\n\nfunction _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError(\"Cannot call a class as a function\"); } }\n\nvar NeuronType = exports.NeuronType = {\n    NONE: \"NONE\",\n    INPUT: \"INPUT\",\n    HIDDEN: \"HIDDEN\",\n    OUTPUT: \"OUTPUT\"\n};\n\nvar LinkType = exports.LinkType = {\n    NONE: \"NONE\",\n    INPUT_TO_HIDDEN: \"INPUT_TO_HIDDEN\",\n    HIDDEN_TO_HIDDEN: \"HIDDEN_TO_HIDDEN\",\n    HIDDEN_TO_OUTPUT: \"HIDDEN_TO_OUTPUT\"\n};\n\nfunction derivativeFn(x) {\n    return x * (1 - x);\n}\n\nvar Neuron = exports.Neuron = function () {\n    function Neuron() {\n        var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : NeuronType.NONE;\n        var key = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;\n        var value = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0.0;\n        var bias = arguments[3];\n\n        _classCallCheck(this, Neuron);\n\n        this.type = type;\n        this.value = value || 0.0;\n        this.key = key || 0;\n        this.bias = bias || +(Math.random() * (0.9 - 0) + 0).toFixed(4);\n    }\n\n    _createClass(Neuron, [{\n        key: \"fn\",\n        value: function fn(x) {\n            return 1.0 / (1.0 + Math.exp(-x));\n        }\n    }, {\n        key: \"computeValue\",\n        value: function computeValue(inputValue) {\n            this.value = this.fn(inputValue);\n        }\n    }, {\n        key: \"getValue\",\n        value: function getValue() {\n            return this.value;\n        }\n    }, {\n        key: \"setValue\",\n        value: function setValue(value) {\n            this.value = value;\n        }\n    }, {\n        key: \"setError\",\n        value: function setError(error) {\n            this.error = error;\n            this.setBias();\n        }\n    }, {\n        key: \"getError\",\n        value: function getError() {\n            return this.error;\n        }\n    }, {\n        key: \"setBias\",\n        value: function setBias() {\n            this.bias += this.error;\n        }\n    }], [{\n        key: \"fromConfig\",\n        value: function fromConfig(config) {\n            return new Neuron(config.type, config.value, config.key, config.bias);\n        }\n    }]);\n\n    return Neuron;\n}();\n\nvar Link = exports.Link = function () {\n    function Link() {\n        var type = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : LinkType.NONE;\n        var neuronFromKey = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;\n        var neuronToKey = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : -1;\n        var weight = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.0;\n\n        _classCallCheck(this, Link);\n\n        this.type = type;\n        this.neuronFromKey = neuronFromKey;\n        this.neuronToKey = neuronToKey;\n        this.weight = weight || +(Math.random() * (0.9 - 0) + 0).toFixed(4);\n    }\n\n    _createClass(Link, [{\n        key: \"generateWeight\",\n        value: function generateWeight() {\n            this.weight = +(Math.random() * (0.9 - 0) + 0).toFixed(4);\n        }\n    }, {\n        key: \"setDeltaWeight\",\n        value: function setDeltaWeight(delta) {\n            this.prevDeltaWeight = this.deltaWeight;\n            this.deltaWeight = delta;\n        }\n    }, {\n        key: \"getDeltaWeight\",\n        value: function getDeltaWeight() {\n            return this.deltaWeight;\n        }\n    }, {\n        key: \"getPrevDeltaWeight\",\n        value: function getPrevDeltaWeight() {\n            return this.prevDeltaWeight;\n        }\n    }, {\n        key: \"setWeight\",\n        value: function setWeight(weight) {\n            this.weight = weight;\n        }\n    }, {\n        key: \"getWeight\",\n        value: function getWeight() {\n            return this.weight;\n        }\n    }], [{\n        key: \"fromConfig\",\n        value: function fromConfig(config) {\n            return new Link(config.type, config.neuronFromKey, config.neuronToKey, config.weight);\n        }\n    }]);\n\n    return Link;\n}();\n\nvar NN = exports.NN = function () {\n    function NN(networkConfiguration) {\n        _classCallCheck(this, NN);\n\n        this.config = networkConfiguration;\n\n        this.networkPreInit();\n        this.createReferences();\n    }\n\n    _createClass(NN, [{\n        key: \"networkPreInit\",\n        value: function networkPreInit() {\n            this.initCore();\n            var _iteratorNormalCompletion = true;\n            var _didIteratorError = false;\n            var _iteratorError = undefined;\n\n            try {\n                for (var _iterator = this.config.layers[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n                    var layer = _step.value;\n\n                    this.createLayer(layer);\n                }\n            } catch (err) {\n                _didIteratorError = true;\n                _iteratorError = err;\n            } finally {\n                try {\n                    if (!_iteratorNormalCompletion && _iterator.return) {\n                        _iterator.return();\n                    }\n                } finally {\n                    if (_didIteratorError) {\n                        throw _iteratorError;\n                    }\n                }\n            }\n        }\n    }, {\n        key: \"initCore\",\n        value: function initCore() {\n            this.inputSize = this.config.layers.find(function (l) {\n                return l.type === NeuronType.INPUT;\n            }).size;\n            this.hiddenSize = this.config.layers.find(function (l) {\n                return l.type === NeuronType.HIDDEN;\n            }).size;\n            this.outputSize = this.config.layers.find(function (l) {\n                return l.type === NeuronType.OUTPUT;\n            }).size;\n\n            this.network = [];\n        }\n    }, {\n        key: \"createLayer\",\n        value: function createLayer(layer) {\n            for (var i = 0; i < layer.size; i++) {\n                this.network.push(new Neuron(layer.type, i));\n            }\n        }\n    }, {\n        key: \"createReferences\",\n        value: function createReferences() {\n            this.references = [];\n\n            for (var h = 0; h < this.hiddenSize; h++) {\n\n                for (var i = 0; i < this.inputSize; i++) {\n                    this.references.push(new Link(LinkType.INPUT_TO_HIDDEN, i, h));\n                }for (var o = 0; o < this.outputSize; o++) {\n                    this.references.push(new Link(LinkType.HIDDEN_TO_OUTPUT, h, o));\n                }\n            }\n        }\n    }, {\n        key: \"computeNeuronsValue\",\n        value: function computeNeuronsValue(neuronType, linkType, fn, print) {\n            var _this = this;\n\n            return this.network.filter(function (h) {\n                return h.type === neuronType;\n            }).forEach(function (h) {\n                h.computeValue(_this.references.filter(function (r) {\n                    return r.type === linkType && r.neuronToKey === h.key;\n                }).reduce(function (prev, curr) {\n                    return prev + curr.weight * fn(curr);\n                }, 0) + h.bias);\n\n                if (neuronType === NeuronType.OUTPUT) if (print) print(h.getValue());\n                //this.outputValue = h.getValue();\n            });\n        }\n    }, {\n        key: \"computeGlobalError\",\n        value: function computeGlobalError(derivativeFunc) {\n            var _this2 = this;\n\n            this.network.filter(function (n) {\n                return n.type === NeuronType.OUTPUT;\n            }).forEach(function (o) {\n                _this2.error = derivativeFn(o.getValue()) * (derivativeFunc(o) - o.getValue());\n                o.setError(_this2.error);\n                _this2.computeHiddenErrors(o);\n            });\n        }\n    }, {\n        key: \"computeHiddenErrors\",\n        value: function computeHiddenErrors(o) {\n            var _this3 = this;\n\n            this.references.filter(function (r) {\n                return r.type === LinkType.HIDDEN_TO_OUTPUT && r.neuronToKey === o.key;\n            }).forEach(function (ref) {\n                var hiddenNeuron = _this3.network.find(function (n) {\n                    return n.type === NeuronType.HIDDEN && n.key === ref.neuronFromKey;\n                });\n                var newWeight = ref.getWeight() + o.error * hiddenNeuron.value;\n                ref.setWeight(newWeight);\n                hiddenNeuron.setError(derivativeFn(hiddenNeuron.getValue()) * o.error * newWeight);\n            });\n        }\n    }, {\n        key: \"adjustInputs\",\n        value: function adjustInputs(derivativeFunc) {\n            var _this4 = this;\n\n            this.network.filter(function (h) {\n                return h.type === NeuronType.HIDDEN;\n            }).forEach(function (h) {\n                _this4.references.filter(function (r) {\n                    return r.type === LinkType.INPUT_TO_HIDDEN && r.neuronToKey === h.key;\n                }).forEach(function (ref) {\n                    var newWeight = ref.getWeight() + h.getError() * derivativeFunc(ref);\n                    ref.setWeight(newWeight);\n                    h.setBias();\n                });\n            });\n        }\n    }, {\n        key: \"trainNetwork\",\n        value: function trainNetwork(trainInputs, trainAnswers, fn) {\n            var _this5 = this;\n\n            this.prevError = 2;\n            this.error = 1;\n\n            this.learnCycles = 0;\n\n            while (this.learnCycles < this.config.cycles) {\n\n                this.learnCycles++;\n\n                var _loop = function _loop(randomSet) {\n\n                    _this5.computeNeuronsValue(NeuronType.HIDDEN, LinkType.INPUT_TO_HIDDEN, function (curr) {\n                        return trainInputs[randomSet][curr.neuronFromKey];\n                    });\n                    _this5.computeNeuronsValue(NeuronType.OUTPUT, LinkType.HIDDEN_TO_OUTPUT, function (curr) {\n                        return _this5.network.find(function (n) {\n                            return n.type === NeuronType.HIDDEN && n.key === curr.neuronFromKey;\n                        }).value;\n                    });\n\n                    _this5.computeGlobalError(function (o) {\n                        return trainAnswers[randomSet][o.key];\n                    });\n                    _this5.adjustInputs(function (ref) {\n                        return trainInputs[randomSet][ref.neuronFromKey];\n                    });\n                };\n\n                for (var randomSet = 0; randomSet < trainInputs.length; randomSet++) {\n                    _loop(randomSet);\n                }\n\n                if (this.learnCycles === this.config.cycles) return fn();\n\n                if (this.learnCycles % 1000 === 0) console.log('LEARN CYCLES ', this.learnCycles);\n            }\n        }\n    }, {\n        key: \"run\",\n        value: function run(data, outputFn) {\n            var _this6 = this;\n\n            var output = [];\n            this.computeNeuronsValue(NeuronType.HIDDEN, LinkType.INPUT_TO_HIDDEN, function (ref) {\n                return data[ref.neuronFromKey];\n            });\n            this.computeNeuronsValue(NeuronType.OUTPUT, LinkType.HIDDEN_TO_OUTPUT, function (curr) {\n                return _this6.network.find(function (n) {\n                    return n.type === NeuronType.HIDDEN && n.key === curr.neuronFromKey;\n                }).value;\n            }, function (value) {\n\n                output.push(value);\n                if (output.length === _this6.outputSize) outputFn(output);\n                // console.log('OUT ', value);\n            });\n        }\n    }, {\n        key: \"networkStringConfiguration\",\n        value: function networkStringConfiguration() {\n            var networkSaveConfig = {\n                configuration: this.config,\n                network: this.network,\n                references: this.references,\n                learnCycles: this.learnCycles\n            };\n\n            return JSON.stringify(networkSaveConfig);\n        }\n    }, {\n        key: \"serializeToFile\",\n        value: function serializeToFile() {\n            (0, _fs.appendFile)(\"d://network.txt\", this.networkStringConfiguration(), function (err) {\n                console.log('append err ', err);\n            });\n        }\n    }, {\n        key: \"deserializeFromFile\",\n        value: function deserializeFromFile(path) {\n            var _this7 = this;\n\n            (0, _fs.readFile)(path, \"utf8\", function (err, content) {\n                if (!err) {\n                    _this7.deserializeObj = JSON.parse(content);\n                    _this7.config = _this7.deserializeObj.configuration;\n                    _this7.network = _this7.deserializeObj.network.map(function (c) {\n                        return Neuron.fromConfig(c);\n                    });\n                    _this7.references = _this7.deserializeObj.references.map(function (c) {\n                        return Link.fromConfig(c);\n                    });\n                    _this7.learnCycles = _this7.deserializeObj.learnCycles;\n\n                    console.log('SUCCESS DESEREALIZING', _this7.learnCycles);\n                } else console.log('FAILED DESERIALIZE NETWORK FILE');\n            });\n        }\n    }]);\n\n    return NN;\n}();"]}