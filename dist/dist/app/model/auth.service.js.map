{"version":3,"sources":["../../../app/model/auth.service.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","core_1","require","Observable_1","rxjs_1","auth_1","AuthService","_store","api","actions$","BehaviorSubject","type","INIT","payload","store$","select","error$","map","data","token$","current$","logins","filter","action","LOGIN_USER","do","dispatch","LOGIN_IN_PROGRESS","mergeMap","loginUser","share","loginSuccess$","token","USER_AUTHENTICATED","loginFailure$","LOGIN_FAILURE","Observable","merge","subscribe","prototype","login","email","password","next","logout","LOGOUT_USER","Injectable","exports"],"mappings":"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","file":"auth.service.js","sourcesContent":["\"use strict\";\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar core_1 = require(\"@angular/core\");\r\nvar Observable_1 = require(\"rxjs/Observable\");\r\nvar rxjs_1 = require(\"rxjs\");\r\nvar auth_1 = require(\"../reducers/auth\");\r\nvar AuthService = (function () {\r\n    function AuthService(_store, api) {\r\n        this._store = _store;\r\n        this.api = api;\r\n        this.actions$ = new rxjs_1.BehaviorSubject({ type: auth_1.INIT, payload: null });\r\n        var store$ = this._store.select('auth');\r\n        this.error$ = store$.map(function (data) { return data['error']; });\r\n        this.token$ = store$.map(function (data) { return data['token']; });\r\n        this.current$ = store$.map(function (data) { return data['current']; });\r\n        var logins = this.actions$\r\n            .filter(function (action) { return action.type === auth_1.LOGIN_USER; })\r\n            .do(function () { return _store.dispatch({ type: auth_1.LOGIN_IN_PROGRESS }); })\r\n            .mergeMap(function (action) { return api.loginUser(action.payload); }).share();\r\n        var loginSuccess$ = logins.filter(function (payload) { return payload.token !== null; })\r\n            .map(function (payload) { return ({ type: auth_1.USER_AUTHENTICATED, payload: payload }); });\r\n        var loginFailure$ = logins.filter(function (payload) { return payload.token === null; })\r\n            .map(function (payload) { return ({ type: auth_1.LOGIN_FAILURE, payload: payload }); });\r\n        Observable_1.Observable\r\n            .merge(loginSuccess$, loginFailure$)\r\n            .subscribe(function (action) { return _store.dispatch(action); });\r\n    }\r\n    AuthService.prototype.login = function (email, password) {\r\n        this.actions$.next({ type: auth_1.LOGIN_USER, payload: { email: email, password: password } });\r\n    };\r\n    AuthService.prototype.logout = function () {\r\n        this.actions$.next({ type: auth_1.LOGOUT_USER });\r\n    };\r\n    return AuthService;\r\n}());\r\nAuthService = __decorate([\r\n    core_1.Injectable()\r\n], AuthService);\r\nexports.AuthService = AuthService;\r\n//# sourceMappingURL=auth.service.js.map"]}